(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const Ee=document.querySelector("#nav-link-1"),z=document.querySelector("#nav-link-2"),zt=()=>{Ee.textContent="Profile",Ee.href="/semester-project-2-olemartin/home",z.addEventListener("click",()=>localStorage.clear()),z.href="./",z.textContent="Logout",document.title="Feed | AuctionHouse"},B=t=>{try{return JSON.parse(localStorage.getItem(t))}catch{return null}},Kt=t=>localStorage.removeItem(t),b=(t,o)=>{localStorage.setItem(t,JSON.stringify(o))},y={base:"https://api.noroff.dev/api/v1/auction/",register:"auth/register",login:"auth/login",account:"profiles/"+B("name")+"?_listings=true",listings:"listings",profiles:"profiles",editAvatar:"profiles/"+B("name")+"/media"},{base:Oe}=y,I={"Content-Type":"application/json",Authorization:`Bearer ${B("auctionToken")}`},x={registerLogin:{method:"POST",headers:{"Content-Type":"application/json"},body:{}},getWithJwt:{method:"GET",headers:I},entry:{method:"POST",headers:I,body:{}},update:{method:"PUT",headers:I,body:{}},deleteOpt:{method:"DELETE",headers:I},react:{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("socialToken")}`}}},p=async(t,o)=>{try{return await(await fetch(Oe+t,o)).json()}catch(s){console.error(s)}},e=(t,o)=>{const s=document.createElement(t);for(const n in o)s.setAttribute(n,o[n]);return s},Re=e("div",{class:"mx-auto w-full mt-15  md:mx-auto md:w-1/2"}),J=e("form",{class:"mt-8 space-y-6 flex flex-col justify-center",method:"POST"}),ce=J.cloneNode(!0),_=e("div",{class:""}),Qt=e("input",{class:"bg-logoBg relative block w-full appearance-none border border-auctionBlue px-3 py-2 focus:outline-auctionBrown",type:"email",placeholder:"email",name:"email",pattern:"^[\\w\\-.]+@(stud.)?noroff.no$",title:"use a @stud.noroff.no mail-adress",required:"required"}),Pe=_.cloneNode(!0);_.append(Qt);const Xt=e("input",{class:"bg-logoBg relative block w-full appearance-none border border-auctionBlue px-3 py-2 focus:outline-auctionBrown",title:"uppercase, lowercase and (_) allowed",placeholder:"name",type:"text",name:"name",pattern:"[\\w]+$"}),Zt=_.cloneNode(!0);Pe.append(Xt);const le=e("div",{class:""}),en=e("input",{class:"bg-logoBg relative block w-full appearance-none border border-auctionBlue px-3 py-2 focus:outline-auctionBrown",type:"password",placeholder:"password",name:"password",minlength:"8",required:"required"});le.append(en);const tn=le.cloneNode(!0),de=e("button",{type:"submit",class:"bg-auctionBlue text-almostWhite p-1  rounded-sm  mx-auto"});de.innerHTML="Login";const Ue=de.cloneNode(!0);Ue.innerHTML="Register";const Y=e("div",{class:"bg-auctionBlue rounded text-center hidden",id:"login-success-alert"}),ue=Y.cloneNode(!0);ue.innerHTML="Account successfully created";Y.innerHTML="Login successful";const D=e("div",{class:"bg-auctionRed rounded text-center hidden",id:"login-warning-alert"});J.append(_,le,de,Y,D);const Je=e("div",{class:"flex flex-col items-center justify-between mt-3"}),_e=e("span",{class:"text-auctionGrey mx-auto"});_e.innerHTML="OR";const nn=e("div",{class:"text-md mt-5 mx-auto"}),me=e("a",{class:"text-almostWhite bg-auctionGrey opacity-50 p-1 ml-1 rounded-sm hover:text-indigo-500",href:"/semester-project-2-olemartin/register"});me.innerHTML="Create an accocunt";nn.append(me);Je.append(_e,me);Re.append(J,Je);const Ye=e("div",{class:"mx-auto w-full mt-15  md:mx-auto md:w-1/2"}),X=D.cloneNode(!0);ce.append(Pe,Zt,tn,Ue,ue,X);Ye.append(ce);const{login:sn}=y,{registerLogin:qe}=x,on=()=>{J.addEventListener("submit",t=>{t.preventDefault();const o=new FormData(t.currentTarget),s=Object.fromEntries(o.entries()),{email:n}=s;qe.body=JSON.stringify(s),p(sn,qe).then(r=>{if(r.email===n){const{name:i,email:a,credits:l,avatar:c,accessToken:u}=r;console.log(r),Y.classList.remove("hidden"),b("auctionToken",u),b("name",i),b("credits",l),b("email",a),b("avatar",c),setTimeout(()=>{window.location.replace("/semester-project-2-olemartin/feed")},2e3)}else r.statusCode===401&&(D.classList.remove("hidden"),D.textContent=r.errors[0].message)})})},{register:rn,login:an}=y,{registerLogin:$}=x,cn=()=>{ce.addEventListener("submit",t=>{t.preventDefault();const o=new FormData(t.currentTarget),s=Object.fromEntries(o.entries()),{name:n}=s;$.body=JSON.stringify(s),console.log($.body),p(rn,$).then(r=>{r.name===n?(console.log(r),ue.classList.remove("hidden"),setTimeout(()=>{p(an,$).then(i=>{const{name:a,email:l,credits:c,avatar:u,accessToken:d}=i;b("auctionToken",d),b("name",a),b("credits",c),b("email",l),b("avatar",u),setTimeout(()=>{window.location.replace("/semester-project-2-olemartin/feed")},2e3)})},2e3)):r.status==="Bad Request"&&(X.classList.remove("hidden"),X.textContent=r.errors[0].message)})})},q=()=>!(localStorage.getItem("auctionToken")===null||localStorage.getItem("auctionToken")==="undefined"),Ve=document.querySelector("#navWithBar"),ln=document.querySelector("#bar"),dn=document.querySelector("#zoomglass"),ze=document.querySelector("#navWithSearch"),Ke=document.querySelector("#filters"),Qe=()=>{ln.addEventListener("click",t=>{t.stopImmediatePropagation(),Ve.classList.toggle("hidden"),Ke.classList.add("hidden"),ze.classList.add("hidden")})},Xe=()=>{dn.addEventListener("click",t=>{t.stopImmediatePropagation(),ze.classList.toggle("hidden"),Ve.classList.add("hidden"),Ke.classList.toggle("hidden")})},un=document.querySelector("#itemContainer"),mn=()=>{un.insertAdjacentElement("beforeend",Re)},pn=document.querySelector("#itemContainer"),gn=()=>{pn.insertAdjacentElement("beforeend",Ye)},ke=document.location.href,fn=()=>{ke.includes("login")?(mn(),on()):ke.includes("register")?(gn(),cn()):q()===!0&&(Qe(),Xe(),zt())},pe=()=>{document.querySelectorAll(".fa-expand").forEach(o=>{o.addEventListener("click",s=>{const n=document.createElement("div");n.setAttribute("class","modal"),document.querySelector("main").append(n);const i=s.currentTarget.nextElementSibling.nextElementSibling.cloneNode(!0);n.append(i),n.addEventListener("click",()=>{document.querySelector(".modal").remove()})})})},Ze=1e3,N=Ze*60,k=N*60,et=k*24,f=t=>{const o=new Date(t),s=new Date;return o-s},bn=(t,o)=>{const s=Math.floor(f(t)%et/k);let n;return o.length>0?n=o[o.length-1].amount:n="0",s<0?'<span class="bg-auctionRed text-auctionGrey">SOLD</span>':"<span>"+s+" hours left</span><span>Bid:"+n+"$</span>"},hn=(t,o)=>{const s=Math.floor(f(t)%k/N);let n;return o.length>0?n=o[o.length-1].amount:n="0",s<0?'<span class="bg-auctionRed text-auctionGrey">SOLD</span>':"<span>"+s+" min left</span><span>Bid:"+n+"$</span>"},xn=t=>{let o=[...t];for(let s=0;s<o.length;s++){let n=!1;for(let r=0;r<o.length;r++)if(o[r]>o[r+1]){let i=o[r];o[r]=o[r+1],o[r+1]=i,n=!0}if(!n)return o}return o},Z=t=>`
  <div
    class="relative aspect-square lg:aspect-square flex flex-col items-center mb-2 shrink justify-between bg-almostWhite overflow-auto hover:overflow-scrollborder-5">
    <i class="absolute fa-sharp fa-solid fa-expand top-5 right-5 text-black fa-lg" id="${t.id}"></i>
    <p class="absolute text-almostWhite p-1 bg-auctionBrown  left-0 bottom-20">${t.title}</p>
    <img 
      src="${t.media[0]}"
      alt="" class="itemImage object-top  object-cover h-2/3 shrink min-w-full img${t.id}">
    <div class="flex text-auctionBlue min-w-full justify-around">
    <div class="flex flex-col m-0 p-0">
    ${bn(t.endsAt,t.bids)}
    </div>
    <a href="/semester-project-2-olemartin/item?id=${t.id}" class="bg-auctionGrey p-1 mb-5 rounded-sm text-almostWhite">view item</a>
    </div>
  </div>
    `,vn=document.querySelector("#listingsFeed"),yn=async t=>{await p("listings?_bids=true&sort=created&sortOrder=desc").then(o=>{const s=o.filter(n=>n.bids.length>0);for(let n=0;n<s.length;n++){const r=s[n];if(n===10)break;vn.insertAdjacentHTML("beforeend",Z(r))}}),pe()},tt=(t,o)=>{const s=document.querySelector(".counterBox"+t),n=e("div",{class:"time flex flex-col"}),r=e("div",{class:"time flex flex-col"}),i=e("div",{class:"time flex flex-col"}),a=e("h2",{class:"mx-auto text-auctionRed"}),l=e("h2",{class:"mx-auto text-auctionRed"}),c=e("h2",{class:"mx-auto text-auctionRed"}),u=e("small",{class:"mx-auto text-auctionRed"}),d=e("small",{class:"mx-auto text-auctionRed"}),h=e("small",{class:"mx-auto text-auctionRed"});u.innerHTML="hours",d.innerHTML="minutes",h.innerHTML="seconds",n.append(a),n.append(u),r.append(l),r.append(d),i.append(c),i.append(h),s.append(n),s.append(r),s.append(i),setInterval(()=>{c.innerHTML=Math.floor(f(o)%N/Ze),l.innerHTML=Math.floor(f(o)%k/N),a.innerHTML=Math.floor(f(o)%et/k)},1e3)},Ln=(t,o,s)=>{t.forEach((n,r)=>{const i=e("button",{class:"border bg-auctionBlue aspect-square flex h-7 mx-3 place-content-center items-center border-2 border-almostWhite drop-shadow-md font-bold"});i.innerHTML=r+1,s.append(i),i.addEventListener("click",l=>{document.querySelector(".bg-auctionBlue").classList.add("bg-slate-400"),document.querySelector(".bg-auctionBlue").classList.remove("bg-auctionBlue"),l.currentTarget.classList.remove("bg-slate-400"),l.currentTarget.classList.add("bg-auctionBlue"),document.querySelector(".currentImg").classList.add("hidden"),document.querySelector(".currentImg").classList.remove("currentImg"),document.getElementById(l.currentTarget.innerHTML).classList.remove("hidden"),document.getElementById(l.currentTarget.innerHTML).classList.add("currentImg")});const a=e("img",{class:" object-top  object-cover h-2/3 shrink w-4/5 mx-auto currentImg aspect-square drop-shadow-md hidden",id:r+1});r===0&&a.classList.remove("hidden"),a.src=n,o.append(a),r!==0&&i.classList.add("bg-slate-400")})},{entry:Ae}=x,wn=(t,o)=>{const s=new FormData(t.currentTarget),n=Object.fromEntries(s.entries()),{amount:r}=n;Ae.body=JSON.stringify({amount:Number(r)}),console.log(n),console.log(o),p(`listings/${o}/bids`,Ae).then(l=>{console.log(l)});const a=B("credits")-Number(r);b("credits",a)},Tn=(t,o,s,n,r,i,a)=>{t.addEventListener("click",l=>{const c=document.createElement("div");c.setAttribute("class","modal"),c.classList.add("bg-auctionGrey"),document.querySelector("main").append(c);const u=L;c.append(u),nt.innerHTML=o,it.innerHTML="Your bid: "+s+"$",st.src=i,ot.innerHTML="<span class='underline underline-offset-2 '>current status</span>"+hn(n,r),rt.innerHTML="Your credits "+B("credits")+"$",at.value=s,ge.addEventListener("click",()=>{document.querySelector(".modal").remove(),window.location.reload()}),document.getElementById("modalSubmit").addEventListener("submit",d=>{d.preventDefault(),d.stopImmediatePropagation(),wn(d,a),ee.classList.remove("bg-orange-300"),ee.classList.add("bg-green-200"),setTimeout(()=>{window.location.reload()},1500)})})},L=e("form",{class:"bg-almostWhite w-4/5 md:w-1/2 h-2/3 mx-auto justify-around flex flex-col my-2 p-5 relative bg-auctionWhite",id:"modalSubmit"}),ge=e("i",{class:" text-auctionRed absolute p-4 aspect-square right-0 top-0 h-7"});ge.innerHTML="<i class='fa-solid fa-xmark fa-xl'></i>";const nt=e("h2",{class:"text-logoBg font-bold w-full text-xl mx-auto my-2 p-1 flex place-content-center "}),st=e("img",{class:"object-top  object-cover h-2/3 shrink w-4/5 mx-auto currentImg aspect-square drop-shadow-md"}),ot=e("h4",{class:" py-3 mx-auto text-lg flex place-content-center flex-col text-logoBg font-bold"}),rt=e("h4",{class:"py-3 absolute left-0 top-1  text-logoBg font-bold"}),it=e("h3",{class:"w-full py-3 mx-auto text-lg flex place-content-center text-logoBg font-bold"}),at=e("input",{id:"bidInput",name:"amount",type:"number",class:"bg-almostWhite border border-2 w-10 bg-white text-auctionGrey hidden",placeholder:"$"}),ee=e("input",{type:"submit",value:"Confirm",class:"border text-lg font-bold border-radius-sm bg-orange-300 text-auctionBrown py-2 px-4"});L.append(nt);L.append(ge);L.append(st);L.append(ot);L.append(rt);L.append(it);L.append(at);L.append(ee);e("input",{type:"submit",value:"Confirm",class:"border border-radius-sm bg-white text-auctionBlue px-2"});e("div",{class:"w-1/2 shrink flex justify-end p-2 gap-1"});const Hn=e("label",{for:"bidInput",class:" text-auctionBrown text-base w-1/2 flex place-content-center items-center"});Hn.textContent="Place a bid";const Bn=(t,o,s,n,r,i,a,l)=>{t.addEventListener("keyup",c=>{c.stopImmediatePropagation();const u=c.currentTarget.value;u-1<o?(s.classList.remove("bg-white"),s.classList.add("bg-red-200"),s.setAttribute("disabled","disabled"),t.setAttribute("title","amount to low")):(s.classList.add("bg-white"),s.classList.remove("bg-red-200"),s.removeAttribute("disabled"),t.removeAttribute("title"),Tn(s,n,u,r,i,a,l))})},ct=t=>{t.addEventListener("click",()=>{window.location.href="./"}),t.innerHTML="&#x2190; back"},Sn=(t,o,s)=>{s.length===0&&(o.remove(),t.remove()),s.forEach(n=>{o.insertAdjacentHTML("beforeend",`
        <div class="w-full text-auctionGrey flex">
        <p class="w-full text-auctionGrey text-center">${n.bidderName}</p>
        <p class="w-full text-auctionGrey text-center">${n.amount} $</p>
        </div>
        `)}),t.addEventListener("click",n=>{o.classList.toggle("hidden")})},Mn=e("div",{class:"counterBox w-full grid grid-cols-3  my-5 p-0"}),lt=e("p",{class:"text-auctionGrey"}),te=e("p",{class:"text-auctionGrey"}),dt=e("div",{class:"w-full bg-green-200 flex justify-around md:w-3/4 mx-auto my-2  flex-wrap "});dt.append(lt,te);const fe=e("button",{class:"px-1 mx-auto text-auctionGrey rounded-sm text-sm bg-auctionYellow mx-auto"});fe.innerHTML="View all bids &darr;";const ut=e("div",{class:"text-auctionGrey w-full hidden bg-auctionYellow w-1/2 mx-auto",id:"bid-section"}),mt=e("input",{id:"bidInput",name:"amount",type:"number",class:"bg-almostWhite border border-2 w-10 bg-white text-auctionGrey",placeholder:"$"}),pt=e("input",{type:"button",value:"SUBMIT",class:"border border-radius-sm bg-white text-auctionBlue px-2"}),be=e("div",{class:"w-1/2 shrink flex justify-end p-2 gap-1"}),he=e("label",{for:"bidInput",class:" text-auctionBrown text-base w-1/2 flex place-content-center items-center"});he.textContent="Place a bid";const gt=e("div",{class:"bg-auctionBlue w-full bg-opacity-50 md:w-3/4 mx-auto flex my-2 p-1"}),ft=e("div",{class:"relative flex flex-col justify-between bg-almostWhite p-3"}),W=e("div",{class:""}),bt=e("h1",{class:"text-auctionBlue block text-xl mx-auto flex place-content-center"}),ne=e("p",{class:"text-auctionBrown mx-auto"}),xe=e("div",{class:"flex place-content-center align-center my-5 flex-wrap"}),ht=e("small",{class:"text-auctionGrey w-full flex place-content-center"});ht.innerHTML="images";xe.append(ht);const xt=e("div",{class:"bg-white p-5 mx-auto flex flex-col   md:w-4/5 border border-auctionBrown rounded-lg drop-shadow-sm my-10"});ft.append(ne,xt);const ve=e("div",{class:"mx-auto my-5 md:w-4/5 flex flex-wrap divide-x divide-slate-200"}),vt=e("h3",{class:"text-md text-auctionBlue w-full"});vt.innerHTML="Description";const yt=e("p",{class:"text-auctionGrey w-1/2 p-1"});ve.append(vt);const Lt=e("p",{class:"text-auctionGrey w-1/2 p-1"});ve.append(yt,Lt);be.append(mt,pt);gt.append(he,be);xt.append(bt,xe,W,Mn,dt,fe,ut,gt,ve);const En=document.querySelector("#itemContainer"),qn=document.querySelector("#listingsFeed"),kn=document.querySelector("main"),An=document.querySelector("#filters"),Ie=document.querySelector("#listingHeader"),In=()=>{qn.innerHTML="",Ie.innerHTML="",An.remove(),document.title="Item | AuctionHouse",kn.classList.remove("bg-auctionBg");const t=document.location.search,s=`listings/${new URLSearchParams(t).get("id")}?_seller=true&_bids=true`;ct(Ie),En.append(ft),p(s).then(n=>{var l,c;n.media.length>0?Ln(n.media,W,xe):(W.innerHTML="No images added to this listing",W.classList.add("text-auctionGrey"));const r=n.endsAt;bt.innerHTML=n.title,q()?ne.innerHTML=`<a href="/semester-project-2-olemartin/user/${n.seller.name}"><span class="text-auctionGrey">seller: </span class="font-bold text-lg">${n.seller.name}</a>`:ne.innerHTML=`<a href="#">${n.seller.name} <span class="text-auctionGrey">(log in to visit ) </span></a>`,f(n.endsAt)>0&&tt("",r),lt.innerHTML="Highest bid",n.bids.length>0?te.innerHTML=n.bids[n.bids.length-1].bidderName+": "+n.bids[n.bids.length-1].amount+"$":te.innerHTML=0+"$",yt.innerHTML=n.description,Lt.innerHTML="tags: "+n.tags.toString(""),f(n.endsAt)<0&&(be.innerHTML="Not possible to bid on this item");const a=(c=(l=n.bids[n.bids.length-1])==null?void 0:l.amount)!=null?c:0;q()?Bn(mt,a,pt,n.title,n.endsAt,n.bids,n.media[0],n.id):he.innerHTML="log in to bid",console.log(n),Sn(fe,ut,n.bids)})},{entry:$e}=x,{listings:$n}=y,jn=t=>{const o=new FormData(t.currentTarget),s=Object.fromEntries(o.entries()),{date:n,tags:r,title:i,description:a}=s,c=new Date(n).toJSON();let u=[],d=r.split(",");document.querySelectorAll("[name='media'").forEach(w=>{w.value.length>0&&u.push(w.value)}),$e.body=JSON.stringify({title:i,description:a,tags:d,media:u,endsAt:c}),p($n,$e).then(w=>{console.log(w)})},m=e("form",{class:" hidden mt-8 bg-logoBg p-3 relative flex flex-col justify-center mx-auto md:w-2/3 w-full",id:"newItem",method:"post",required:"required"}),wt=e("small",{class:"text-almostWhite mx-auto mt-2"});wt.innerHTML="Title";const Gn=e("input",{class:"bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"text",name:"title",id:"titleInput",placeholder:"Title",required:"required"}),Tt=e("small",{class:"text-almostWhite mx-auto mt-2"});Tt.innerHTML="tags";const Cn=e("input",{class:"bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"text",name:"tags",id:"tagsInput",placeholder:"tags"}),Ht=e("small",{class:"text-almostWhite mx-auto mt-2"});Ht.innerHTML="Description";const Wn=e("input",{class:"bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"text",name:"description",id:"descriptionInput",placeholder:"description"}),Bt=e("small",{class:"text-almostWhite mx-auto mt-2"});Bt.innerHTML="Image URL's";const Dn=e("input",{class:"bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"url",name:"media",id:"mediaInput",placeholder:"media URL"}),se=e("input",{class:"hidden bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"url",name:"media",id:"mediaInput1",placeholder:"media URL",disabled:"disabled"}),oe=e("input",{class:"hidden bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"url",name:"media",id:"mediaInput2",placeholder:"media URL",disabled:"disabled"}),re=e("input",{class:"hidden bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"url",name:"media",id:"mediaInput3",placeholder:"media URL",disabled:"disabled"}),Nn=e("input",{class:"bg-almostWhite mt-2 rounded p-1 text-black py-1",type:"datetime-local",name:"date",id:"dateInput",placeholder:"ends at",required:"required"}),Fn=e("input",{class:"mt-2 rounded-none py-3 bg-auctionBlue",type:"submit",placeholder:"submit"}),ye=e("button",{class:"text-sm p-0 m-0 border rounded-none mx-auto px-1 mt-1",type:"button"});ye.innerHTML="Add photos &#8595";ye.addEventListener("click",t=>{se.classList.remove("hidden"),oe.classList.remove("hidden"),re.classList.remove("hidden"),se.removeAttribute("disabled"),oe.removeAttribute("disabled"),re.removeAttribute("disabled"),t.currentTarget.classList.add("hidden")});m.append(wt);m.append(Gn);m.append(Tt);m.append(Cn);m.append(Ht);m.append(Wn);m.append(Bt);m.append(Dn);m.append(se);m.append(oe);m.append(re);m.append(ye);m.append(Nn);m.append(Fn);const{deleteOpt:On}=x,{listings:Rn}=y,Pn=t=>{t.addEventListener("click",()=>{fetch(Oe+Rn+"/"+t.id,On),setTimeout(()=>{window.location.reload()},500)})},{update:je}=x,{listings:Un}=y,Jn=(t,o)=>{const s=new FormData(t.currentTarget),n=Object.fromEntries(s.entries()),{tags:r,title:i,description:a}=n;let l=[],c=r.split(",");t.currentTarget.querySelectorAll("[name='media'").forEach(d=>{d.value.length>0&&l.push(d.value)}),je.body=JSON.stringify({title:i,description:a,tags:c,media:l}),p(Un+"/"+o,je).then(d=>{console.log(d)})},{listings:_n}=y,{getWithJwt:Yn}=x,Vn=t=>{t.addEventListener("click",o=>{o.stopImmediatePropagation();const s=e("i",{class:"fa-solid fa-xmark fa-xl text-almostWhite absolute p-4 aspect-square right-0 top-0 h-7 hover:bg-auctionGreen"});g.append(s),g.classList.remove("hidden"),H.classList.add("modal"),H.classList.remove("hidden");const n=g.dateInput;n.remove();const r=g.querySelector("button");r.remove();const i=g.tags,a=Array.from(g.media);g.querySelectorAll(".hidden").forEach(c=>{c.classList.remove("hidden")}),p(_n+"/"+o.currentTarget.id,Yn).then(c=>{g.title.value=c.title,g.description.value=c.description,c.media.forEach((d,h)=>{a[h].value=d}),i.value=c.tags.join(", ")}),s.addEventListener("click",()=>{s.remove(),g.append(n),g.append(r),g.classList.add("hidden"),H.classList.remove("modal"),H.classList.add("hidden")}),g.addEventListener("submit",c=>{c.preventDefault(),Jn(c,t.id),setTimeout(()=>{window.location.reload()},1e3)})})},St=(t,o=0)=>{let s;return function(...n){clearTimeout(s),s=setTimeout(()=>t.apply(this,n),o)}},{editAvatar:zn}=y,{update:Ge}=x,Kn=t=>{t.addEventListener("click",o=>{o.stopImmediatePropagation(),T.classList.remove("hidden"),T.classList.add("modal");const s=e("i",{class:"fa-solid fa-xmark fa-xl text-almostWhite absolute p-4 aspect-square right-5 top-5 h-7 hover:bg-auctionGreen"});T.append(E,s);const n=E.media,r=E.avatar;s.addEventListener("click",()=>{T.classList.add("hidden"),T.classList.remove("modal")}),n.addEventListener("input",St(i=>{r.src=i.target.value},1e3)),E.addEventListener("submit",i=>{i.preventDefault(),Ge.body=JSON.stringify({avatar:n.value}),p(zn,Ge).then(a=>{console.log(a),Kt("avatar"),b("avatar",a.avatar),setTimeout(()=>{window.location.reload()},1e3)})})})},Mt=e("div",{class:"w-full  lg:w-2/4 sm:w-3/4 self-center flex flex-wrap"}),Et=e("img",{class:"w-1/3 sm:w-1/2 apect-square mx-auto border rounded-lg max-w-lg"}),qt=e("div",{class:"w-2/3 sm:w-1/2 text-auctionGrey sm:grid sm:grid-rows-4 p-2"}),kt=e("h2",{class:" text-auctionGrey text-xl "}),Le=e("button",{class:"border bg-auctionGrey text-almostWhite h-8 m-0 text-sm w-1/2 self-end"});Le.innerHTML="Edit avatar";Kn(Le);const At=e("p",{class:" text-auctionGrey"}),It=e("p",{class:" text-auctionGrey"});qt.append(kt,At,It,Le);const $t=e("div",{class:"w-full   my-5"}),we=e("button",{class:" px-3 py-2 bg-auctionGreen rounded mx-auto border-none w-full"});$t.append(we,m);we.innerHTML="Add listing";Mt.append(Et,qt,$t);const jt=e("div",{class:"py-20"}),Gt=e("h2",{class:"text-lg text-auctionGrey "});Gt.innerHTML="Your listings";const Ct=e("div",{class:"w-full flex justify-start"}),F=e("button",{class:"rounded-xl bg-auctionBlue  mx-1 md:w-40 py-1 w-1/4"});F.innerHTML="Acitve";const O=e("button",{class:"rounded-xl bg-logoBg mx-1 py-1 md:w-40 w-1/4  "});O.innerHTML="All";Ct.append(F,O);jt.append(Gt,Ct);const K=(t,o,s,n,r)=>{const i=e("div",{class:"w-full grid grid-rows-4 sm:grid-rows-1 sm:grid-cols-4 relative sm:h-40 border rounded border-auctionBrown border-1 my-2"}),a=e("img",{class:"h-20 w-20 aspect-square object-cover m-auto"});a.src=t;const l=e("div",{class:"flex flex-col justify-around"}),c=e("p",{class:"text-auctionGrey m-auto"});c.innerHTML=o;const u=e("p",{class:"text-auctionGrey m-auto"});u.innerHTML=s,l.append(c,u);const d=e("div",{class:"flex flex-col justify-around p-3"}),h=e("button",{class:"bg-auctionBlue text-auctionGrey w-1/2 mx-auto my-1",id:r});Vn(h),h.innerHTML="Update";const w=e("button",{class:"bg-auctionRed text-auctionGrey w-1/2 mx-auto my-1",id:r});w.innerHTML="Delete",Pn(w),d.append(h,w);const Me=e("div",{class:"flex p-3"}),V=e("a",{class:"text-auctionGrey m-auto bg-veryLightGrey h-1/2 w-full border rounded-lg items-center flex place-content-center"});return V.href=n,V.innerHTML="Visit",Me.append(V),i.append(a,l,d,Me),i},Wt=t=>f(t)<0?"<span class='bg-red-300 bg-opacity-30 p-2 text-auctionGrey'>FINISED</span>":"<span class='bg-auctionGreen bg-opacity-30 p-2 text-auctionGrey'>ACTIVE</span>",Qn=t=>!(f(t)<0),E=e("form",{id:"avatarForm",class:"w-2/3 h-2/3 rounded-sm bg-logoBg flex flex-col align-items-center relative"}),Xn=e("input",{class:" bg-almostWhite my-2 rounded p-1 text-black ",type:"url",name:"media",id:"avatarInput",placeholder:"avatar URL"}),Dt=e("button",{type:"submit",class:"bg-auctionBlue rounded-none w-40 mx-auto my-5"});Dt.innerHTML="Update";const Nt=e("img",{class:"w-1/2 rounded-lg m-2",name:"avatar"});Nt.src=B("avatar");E.append(Nt,Xn,Dt);const Ce=(t,o,s,n)=>{t.remove(),t.innerHTML="",o.append(t),s.forEach(r=>{t.insertAdjacentElement("beforeend",n(r.media[0],r.title,Wt(r.endsAt),`/semester-project-2-olemartin/item?id=${r.id}`,r.id))})},{account:Zn}=y,{getWithJwt:es}=x,ts=document.querySelector("#listingHeader"),j=document.querySelector("#itemContainer"),G=e("div",{class:""}),H=e("div",{class:"w-full aspect-square hidden"}),g=m.cloneNode(!0),T=e("div",{class:"w-full aspect-square hidden"}),ns=async()=>{document.body.append(H,T),j.classList.add("min-h-screen"),document.title="Profile | AuctionHouse",ts.innerHTML="Your details",g.id="updateForm",H.append(g),j.append(Mt,jt,G);const t=[],o=[];await p(Zn,es).then(s=>{console.log(s),Et.src=s.avatar,kt.innerHTML=s.name,At.innerHTML=s.email,It.innerHTML="Your wallet "+s.credits+"$",s.listings.forEach(n=>{G.insertAdjacentElement("beforeend",K(n.media[0],n.title,Wt(n.endsAt),`/semester-project-2-olemartin/item?id=${n.id}`,n.id)),Qn(n.endsAt)&&t.push(n),o.push(n)})}),F.append("("+t.length+")"),O.append("("+o.length+")"),F.addEventListener("click",()=>{Ce(G,j,t,K)}),O.addEventListener("click",()=>{Ce(G,j,o,K)}),we.addEventListener("click",s=>{m.classList.toggle("hidden")}),m.addEventListener("submit",s=>{s.preventDefault(),jn(s)})},Te=e("div",{class:"w-full flex lg:w-2/4 md:w-3/4 self-center"}),Ft=e("img",{class:"w-1/2 apect-square mx-auto border rounded-lg max-w-lg"}),Ot=e("h2",{class:"w-1/2 mx-auto text-auctionGrey text-xl flex items-center place-content-center"});Te.append(Ft);Te.append(Ot);const ie=e("div",{class:"py-20"}),Rt=e("h2",{class:"text-lg text-auctionGrey"});ie.append(Rt);const ss=(t,o,s,n)=>{const r=e("a",{class:"w-full grid grid-cols-3 relative h-24 items-center border rounded border-auctionBrown my-2 place-content-center"});r.href=t;const i=e("img",{class:"h-12 w-12 aspect-square object-cover mx-auto"});i.src=o;const a=e("p",{class:"text-auctionGrey"});a.innerHTML=s;const l=e("p",{class:"text-auctionGrey"});return l.innerHTML=n,r.append(i,a,l),r},We=t=>f(t)<0?"<span class='bg-red-300 bg-opacity-30 p-2 text-auctionGrey'>FINISED</span>":"<span class='bg-auctionGreen bg-opacity-30 p-2 text-auctionGrey'>ACTIVE</span>",ae=e("div",{class:"py-10"}),Pt=e("h2",{class:"text-lg text-auctionGrey "});ae.append(Pt);const os=(t,o,s)=>{const n=e("a",{class:"w-full grid grid-cols-3 relative h-20 items-center border rounded border-auctionBrown my-2 place-content-center"});n.href=t;const r=e("p",{class:"text-auctionGrey"});r.innerHTML=o;const i=e("p",{class:"text-auctionGrey"});return i.innerHTML=s,n.append(r,"-",i),n},De=()=>{const t=document.location.href;return t.substring(t.lastIndexOf("/")+1,t.length)},rs=document.querySelector("#itemContainer"),is=document.querySelector("#listingHeader"),{getWithJwt:Ne}=x,as=()=>{ct(is);const t=`profiles/${De()}?_listings=true `,o=`profiles/${De()}/bids?_listings=true`;rs.append(Te,ie,ae),p(t,Ne).then(s=>{Ft.src=s.avatar,Ot.innerHTML=s.name,Rt.innerHTML=s.name+"'s listings",s.listings.forEach(n=>{ie.insertAdjacentElement("beforeend",ss(`/semester-project-2-olemartin/item?id=${n.id}`,n.media[0],n.title,We(n.endsAt)))})}),p(o,Ne).then(s=>{console.log(s),Pt.innerHTML=s[0].bidderName+" made bid's on these listings",s.forEach(n=>{ae.insertAdjacentElement("beforeend",os(`/semester-project-2-olemartin/item?id=${n.listing.id}`,n.listing.title,We(n.listing.endsAt)))})})},cs=()=>{document.location.href.includes("item")?In():document.location.href.includes("user")&&q()?as():document.location.href.includes("home")?ns():document.querySelector("#listingsFeed")&&!document.location.href.includes("login")&&!document.location.href.includes("register")&&yn()},ls=()=>{document.querySelector("#listingsFeed")&&(Qe(),Xe())},R=e("button",{class:"text-almostWhite bg-logoBg w-1/4  rounded-none px-1 border-none mx-auto w-30 enabled:hover:outline-none",id:"filter-link-1"});R.innerHTML="Newest";const P=e("button",{class:"text-almostWhite bg-logoBg w-1/4  rounded-none px-1 border-none mx-auto w-30 enabled:hover:outline-none",id:"filter-link-2"});P.innerHTML="Expiring today";const He=e("nav",{class:""}),Ut=e("div",{class:"flex self-center"}),Jt=e("p",{class:"text-logoBg m-auto"});Jt.innerHTML="sort by";const Be=e("div",{class:"flex flex-col md:flex-row md:pb-0 pb-0 gap-2"});Ut.append(Jt);Be.append(P);Be.append(R);He.append(Ut);He.append(Be);const U=e("button",{class:"px-5 border border-1 text-logoBg py-2 mx-auto block"});U.innerHTML="Next";const S=e("button",{class:"border border-logoBg py-1 mx-2 w-20 enabled:hover:outline-none text-black"});S.innerHTML="titles";const M=e("button",{class:"border border-logoBg py-1 mx-2 w-20 enabled:hover:outline-none text-black"});M.innerHTML="users";const A=e("button",{class:"border border-logoBg py-1 mx-2 w-20 enabled:hover:outline-none text-black"});A.innerHTML="tags";const _t=(t,o,s,n)=>{const r=e("a",{class:"w-full grid grid-cols-3 relative h-24 items-center border rounded border-auctionBrown my-2 place-content-center"});r.href=t;const i=e("img",{class:"h-12 w-12 aspect-square object-cover mx-auto"});i.src=o;const a=e("p",{class:"text-auctionGrey"});a.innerHTML=s;const l=e("p",{class:"text-auctionGrey"});return l.innerHTML=n,r.append(i,a,l),r},Yt=t=>f(t)<0?"<span class='bg-red-300 bg-opacity-30 p-2 text-auctionGrey'>FINISED</span>":"<span class='bg-auctionGreen bg-opacity-30 p-2 text-auctionGrey'>ACTIVE</span>",ds=(t,o,s)=>{const n=e("a",{class:"w-full grid grid-cols-2 relative h-24 items-center border rounded border-auctionBrown my-2 place-content-center"});n.href="/semester-project-2-olemartin/user/"+t;const r=e("img",{class:"h-12 w-12 aspect-square object-cover mx-auto"});r.src=o;const i=e("p",{class:"text-auctionGrey"});return i.innerHTML=s,n.append(r,i),n},us=document.querySelector("#listingsFeed"),ms=document.querySelector("#itemContainer"),ps=document.querySelector("#searchForm"),C=document.querySelector("#filters"),gs=()=>{ps.addEventListener("input",()=>{us.innerHTML="",ms.innerHTML=`<div class="h-screen flex items-start place-content-center">
            <div class="relative w-24 h-24 animate-spin rounded-full bg-gradient-to-r from-auctionGreen via-logoBg to-auctionBlue ">
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-gray-200 rounded-full border-2"></div>
            </div>
            </div>`,C.innerHTML="",C.append(S,A,M),C.classList.remove("md:columns-2","md:block"),C.classList.add("md:flex","place-content-center")})},Q=document.querySelector("#listingsFeed");document.querySelector("#filter-link-1");const fs=document.querySelector("#listingHeader"),Vt=async(t,o)=>{let s=t;Q.innerHTML="",fs.innerHTML="Recently added items",await p("listings?_bids=true&sort=created&sortOrder=desc").then(r=>{const i=r.filter(a=>a.media[0]!==void 0);for(s;s<o;s++){const a=i[s];Z(a),Q.insertAdjacentHTML("beforeend",Z(a))}}),pe(),Q.insertAdjacentElement("afterend",U);let n=0;U.addEventListener("click",r=>{r.stopImmediatePropagation(),n++,Vt(14*n,28*n)})},bs=t=>`
    <div
    class="relative aspect-square lg:aspect-square flex flex-col items-center mb-2 shrink justify-between bg-almostWhite overflow-auto hover:overflow-scrollborder-5">
    <i class="absolute fa-sharp fa-solid fa-expand top-5 right-5 text-black fa-lg" id="${t.id}"></i>
    <p class="absolute text-almostWhite p-1 bg-auctionBrown  left-0 bottom-20">${t.title}</p>
    <img 
      src="${t.media[0]}"
      alt="" class="itemImage object-top  object-cover h-2/3 shrink min-w-full img${t.id}">
    <div class="flex text-auctionBlue min-w-full justify-around counterB">
    <div class="grid grid-cols-3  m-0 p-0 w-1/2 counterBox${t.id}">
    </div>
    <a href="/semester-project-2-olemartin/item?id=${t.id}" class="bg-auctionGrey p-1 mb-5 rounded-sm text-almostWhite">view item</a>
    </div>
  </div>
    `,Fe=document.querySelector("#listingsFeed"),hs=document.querySelector("#listingHeader"),xs=async(t,o)=>{let s=t;Fe.innerHTML="",hs.innerHTML="Expires today",await p("listings?_bids=true&sort=created&sortOrder=desc").then(n=>{const r=n.filter(c=>f(c.endsAt)<864e5&&f(c.endsAt)>0),i=[];r.forEach(c=>{i.push(c.endsAt)});const a=xn(i),l=[];for(let c=0;c<a.length;c++){const u=a[c];for(let d=0;d<r.length;d++){let h=r[d];r[d].endsAt===u&&!l.includes(r[d])&&l.push(h)}}for(s=0;s<o;s++){const c=l[s];if(c===void 0)break;const u=c.endsAt,d=c.id;Fe.insertAdjacentHTML("beforeend",bs(c)),tt(d,u)}}),pe()},v=document.querySelector("#itemContainer"),Se=document.querySelector("#listingHeader"),vs=t=>{S.addEventListener("click",o=>{o.currentTarget.classList.add("bg-auctionBlue"),A.classList.remove("bg-auctionBlue"),M.classList.remove("bg-auctionBlue"),v.innerHTML="",setTimeout(()=>{(v.innerHTML.includes("-translate-x-1/2")||v.innerHTML==="")&&(v.innerHTML="<p class='font-bold text-black mx-auto'>No results. <a href='./'>Go back</a></p>")},1500),t.forEach(s=>{v.insertAdjacentElement("beforeend",_t(`/semester-project-2-olemartin/item?id=${s.id}`,s.media[0],s.title,Yt(s.endsAt)))})}),S.click(),Se.innerHTML="Search by title"},ys=t=>{A.addEventListener("click",o=>{Se.innerHTML="Search by tags",o.currentTarget.classList.add("bg-auctionBlue"),S.classList.remove("bg-auctionBlue"),M.classList.remove("bg-auctionBlue"),v.innerHTML="",t.forEach(s=>{v.insertAdjacentElement("beforeend",_t(`/semester-project-2-olemartin/item?id=${s.id}`,s.media[0],s.title,Yt(s.endsAt)))})})},Ls=t=>{M.addEventListener("click",o=>{Se.innerHTML="Search by user",o.currentTarget.classList.add("bg-auctionBlue"),S.classList.remove("bg-auctionBlue"),A.classList.remove("bg-auctionBlue"),v.innerHTML="",t.forEach(s=>{v.insertAdjacentElement("beforeend",ds(s.name,s.avatar,s.name))})})},{getWithJwt:ws}=x,Ts=document.querySelector("#searchForm"),Hs=()=>{Ts.addEventListener("input",St(t=>{Bs(t)},1e3))},Bs=t=>{p("listings").then(o=>{const s=o.filter(r=>Boolean(r.tags.map(a=>a.toLowerCase()).filter(a=>a.includes(t.target.value)).length)),n=o.filter(r=>r.title.includes(t.target.value));vs(n),ys(s)}),q()?p("profiles",ws).then(o=>{const s=o.filter(n=>n.name.includes(t.target.value));Ls(s),console.log(o)}):M.remove()},Ss=document.querySelector("#filters"),Ms=()=>{Ss.insertAdjacentElement("beforeend",He),R.addEventListener("click",t=>{document.querySelector("#itemContainer")&&document.querySelector("#itemContainer").remove(),Vt(0,14),t.currentTarget.classList.add("bg-auctionBlue"),P.classList.remove("bg-auctionBlue")}),P.addEventListener("click",t=>{U.remove(),document.querySelector("#itemContainer")&&document.querySelector("#itemContainer").remove(),xs(0,14),t.currentTarget.classList.add("bg-auctionBlue"),R.classList.remove("bg-auctionBlue")}),gs(),Hs()},Es=()=>{window.location.href.includes("authentication")||Ms()};Es();fn();ls();cs();
